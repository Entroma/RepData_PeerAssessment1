---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r include=FALSE} 
# Global Options: 
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE) 
```
## Loading and preprocessing the data
```{r}
wd <- getwd();
if(!dir.exists(file.path(wd, 'activity'))){
  zip <- paste(wd, 'activity.zip', sep = '/');
  outDir <- paste(wd, 'activity', sep = '/');
  unzip(zip,exdir=outDir)
}

ds <- read.csv2('activity/activity.csv', sep = ',')
```


## What is mean total number of steps taken per day?
```{r fig.width=10, fig.height=6}
# Find all Na rows in ds$steps
x <- is.na(ds$steps)
# Remove the NA rows and store the new data.frame as df
df <- ds[!x,]
# Load dplyr for the summary stats
library(dplyr)
# Use piping to create a new data.frame with all the daily steps grouped by say
sums <- df %>% group_by(date) %>%
        summarise(total.steps = sum(steps), mean.steps = mean(steps),
                  median.steps = median(steps))
# Create a histogram of the total steps per day
library(ggplot2)
cols <- quantile(sums$total.steps)
sums$group <- ifelse(sums$total.steps <= cols[1], 'a',
                     ifelse(sums$total.steps <= cols[2], 'b',
                            ifelse(sums$total.steps <= cols[4], 'c', 
                                   ifelse(sums$total.steps <= cols[5], 
                                          'd', 'e'))))
a = 0.65
ggplot(sums, aes(x = total.steps)) + 
  geom_histogram(binwidth = 450, data = subset(sums, group == 'a'), alpha = a,
                 aes(fill = group)) +
  geom_histogram(binwidth = 450, data = subset(sums, group == 'b'), alpha = a,
                 aes(fill = group))+
  geom_histogram(binwidth = 450, data = subset(sums, group == 'c'), alpha = a,
                 aes(fill = group))+
  geom_histogram(binwidth = 450, data = subset(sums, group == 'd'), alpha = a,
                 aes(fill = group)) +
  geom_histogram(binwidth = 450, data = subset(sums, group == 'e'), alpha = a,
                 aes(fill = group)) +
  ggtitle('Total Steps Per Day') + xlab('Total Steps Taken') + ylab('Density')+
  geom_density() + scale_fill_manual(name = 'group',
      values = c('red','orange', 'yellow', 'pink',
                               'aquamarine'),
                    labels = c('First quartile', 'Second Quartile', 
                               'Mid-range', 'Third Quarile', 'Fourth quartile'))

```
```{r}
# Mean steps per day
print('Mean steps a day: ')
print(sums[,c('date', 'mean.steps')])
```
```{r}
# Median steps per day
print('Median steps taken per day')
print(sums[c('date', 'median.steps')])
```

## What is the average daily activity pattern?
```{r}
pattern.df <- df %>% group_by(interval) %>%
  summarise(average.steps = mean(steps))
ggplot(data = pattern.df, aes(x = interval, y = average.steps)) + geom_line() +
  xlab('5 - Minute Interval') + ylab('Average Daily Steps') + 
  ggtitle('Daily Activity Pattern') + 
  geom_hline(yintercept =  mean(df$steps), show.legend = TRUE)
  
```
```{r}
print('The inerval with the highest mean number of steps is: ')
print(pattern.df[max(pattern.df$average.steps) == pattern.df$average.steps,
                 "interval"])
```


## Imputing missing values
```{r}
# Coun the number of rows with Na values
total.nas <- sum((is.na(ds$steps) | is.na(ds$date) | is.na(ds$interval)))
print('The total number of rows wih an NA value is: ')
print(total.nas)
```
```{r}
# Using the mean value o impute all missing rows:
full.ds <- ds
# Fill in the missing data with the mean value. all other columns have no Nas
# So we only impute u=into steps.
full.ds[x, 'steps'] <- mean(df$steps)
#  Making he daily satistics
full.sums <- full.ds %>% group_by(date) %>% 
  summarise(total.steps = sum(steps), mean.steps = mean(steps),
            median.steps = median(steps))
# Make the hisogram of total daily steps:
cols <- quantile(full.sums$total.steps)
full.sums$group <- ifelse(full.sums$total.steps <= cols[1], 'a',
                     ifelse(full.sums$total.steps <= cols[2], 'b',
                            ifelse(full.sums$total.steps <= cols[4], 'c', 
                                   ifelse(full.sums$total.steps <= cols[5], 
                                          'd', 'e'))))
a = 0.65

ggplot(full.sums, aes(x = total.steps)) + 
  geom_histogram(binwidth = 450, data = subset(full.sums, group == 'a'),
                 alpha = a, aes(fill = group)) +
  geom_histogram(binwidth = 450, data = subset(full.sums, group == 'b'),
                 alpha = a, aes(fill = group))+
  geom_histogram(binwidth = 450, data = subset(full.sums, group == 'c'),
                 alpha = a,aes(fill = group))+
  geom_histogram(binwidth = 450, data = subset(full.sums, group == 'd'),
                 alpha = a, aes(fill = group)) +
  geom_histogram(binwidth = 450, data = subset(full.sums, group == 'e'),
                 alpha = a, aes(fill = group)) +
  ggtitle('Total Steps Per Day') + xlab('Total Steps Taken') + ylab('Density')+
  geom_density() + scale_fill_manual(name = 'group',
      values = c('red','orange', 'yellow', 'pink',
                               'aquamarine'),
                    labels = c('First quartile', 'Second Quartile', 
                               'Mid-range', 'Third Quarile', 'Fourth quartile'))
```
```{r}
print('The mean number of steps taken per day for this dataset is: ')
print(full.sums$mean.steps)
```
```{r}
print('The median number of steps taken per day for this dataset is: ')
print(full.sums$median.steps)
```
As seen, imputing missing data changes the estimates as follows: 
* The mean number of steps per day is now esimated to be higher
* The median number of steps per day is non zero on the imputed rows
* Imputing missing values increases the estimated total number of steps per day
```
## Are there differences in activity patterns between weekdays and weekends?
```{r}
day.types <- weekdays(full.sums$date)
```